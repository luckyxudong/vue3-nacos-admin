---
name: 配置列表功能实现
overview: 实现配置列表页面功能，包括多条件查询、模糊搜索、分页排序等。接口调用使用 mock 数据，需要优化 mock 数据以支持不同 tenant（命名空间）的数据隔离。同时选择并集成所需的 shadcn-vue 组件。
todos: []
isProject: false
---

# 配置列表功能实现计划

## 功能需求

根据 React 实现 (`ConfigurationManagement.js`)，配置列表页面需要实现以下功能：

### 核心功能

1. **配置列表查询**
   - 展示当前命名空间下的所有配置列表
   - 页面顶部支持不同命名空间的切换
   - 表格展示：Data ID、Group、类型、应用、操作

2. **多条件组合查询**
   - `dataId`: 支持模糊/精确搜索（通过 `search` 参数控制）
   - `group`: 支持模糊/精确搜索（下拉选择，支持自动完成）
   - `appName`: 应用名称过滤（高级查询）
   - `config_tags`: 标签过滤（逗号分隔，高级查询）
   - `types`: 类型过滤（逗号分隔，如 text,json,yaml，高级查询）
   - `config_detail`: 配置内容搜索（高级查询）

3. **搜索模式**
   - 模糊搜索 (`search=blur`): dataId 和 group 会自动添加 `*` 通配符
   - 精确搜索 (`search=accurate`): 完全匹配
   - 通过 Switch 组件切换搜索模式

4. **分页和排序**
   - `pageNo`: 页码
   - `pageSize`: 每页数量（可配置）
   - 支持按列排序（Data ID、Group、类型、应用）

5. **命名空间隔离**
   - `tenant`: 命名空间 ID，用于数据隔离
   - 不同 tenant 应返回不同的配置列表
   - 切换命名空间时重新加载数据

6. **高级查询**
   - 可展开/收起的高级查询区域
   - 包含：应用名称、标签、类型、配置内容搜索

7. **批量操作**
   - 表格行选择（多选）
   - 批量删除
   - 批量克隆
   - 导出选中项

8. **操作功能**
   - 创建配置（跳转到创建页面）
   - 查看详情（跳转到详情页面）
   - 编辑配置（跳转到编辑页面）
   - 删除配置（单个/批量）
   - 导出配置（全部/选中）
   - 导入配置

## Mock 数据优化需求

当前 `mock/config.ts` 存在的问题：

- 只有一个全局的 `configList`，所有 tenant 共享同一份数据
- 查询接口虽然接收 `tenant` 参数，但没有根据 tenant 过滤数据
- 缺少对模糊搜索的支持（通配符处理）
- 缺少对 `appName`、`config_tags`、`types`、`config_detail` 的过滤支持

## Shadcn-Vue 组件选择

根据配置列表页面的功能需求，需要以下 shadcn-vue 组件：

### 必需组件（需要安装）

1. **table** - 配置列表表格展示
   - 用途：展示配置列表（Data ID、Group、类型、应用、操作）
   - 特性：支持排序、行选择、加载状态

2. **select** - 下拉选择组件
   - 用途：Group 下拉选择（支持自动完成）
   - 特性：支持搜索、多选（用于标签和类型选择）

3. **switch** - 开关组件
   - 用途：模糊搜索模式切换开关
   - 特性：切换模糊/精确搜索模式

4. **pagination** - 分页组件
   - 用途：配置列表分页展示
   - 特性：支持页码切换、每页数量选择

5. **form** - 表单组件
   - 用途：查询表单布局和验证
   - 特性：表单字段管理、验证

6. **dropdown-menu** - 下拉菜单组件
   - 用途：导出按钮的下拉菜单（导出、新导出、导出选中、新导出选中）
   - 特性：菜单项点击事件

### 可选组件（根据需求）

7. **badge** - 徽章组件
   - 用途：标签显示、状态标识
   - 特性：不同颜色变体

8. **dialog** - 对话框组件
   - 用途：删除确认对话框、详情展示
   - 特性：模态对话框、确认操作

9. **combobox** - 组合框组件
   - 用途：Group 的自动完成输入（替代 Select.AutoComplete）
   - 特性：输入搜索、下拉选择

### 已有组件（无需安装）

- **button** - 按钮组件（已安装）
- **input** - 输入框组件（已安装）
- **label** - 标签组件（已安装）
- **card** - 卡片组件（已安装，用于 DashboardCard）

### 组件安装命令

```bash
# 安装必需组件
pnpm shadcn-vue@latest add table
pnpm shadcn-vue@latest add select
pnpm shadcn-vue@latest add switch
pnpm shadcn-vue@latest add pagination
pnpm shadcn-vue@latest add form
pnpm shadcn-vue@latest add dropdown-menu

# 可选组件
pnpm shadcn-vue@latest add badge
pnpm shadcn-vue@latest add dialog
pnpm shadcn-vue@latest add combobox
```

## Mock 数据优化方案

### 1. 数据结构优化

将 `configList` 改为按 tenant 分组的结构：

```typescript
// 从单一数组改为按 tenant 分组的对象
const configListByTenant: Record<string, Config[]> = {}
```

### 2. 数据生成策略

- 为每个 tenant 生成独立的配置数据（30-50 条）
- 使用命名空间的 `namespace` 字段作为 tenant 标识
- 确保不同 tenant 的数据互不干扰

### 3. 查询逻辑完善

在 `GET /api/v1/cs/configs` 接口中：

1. **Tenant 过滤**
   - 根据 `tenant` 参数获取对应命名空间的配置列表
   - 如果 tenant 不存在，返回空列表或创建默认数据

2. **模糊搜索支持**
   - 当 `search=blur` 时，处理通配符 `*`（如 `*keyword*`）
   - 使用字符串包含匹配而非完全匹配

3. **多条件过滤**
   - `dataId`: 根据搜索模式进行模糊/精确匹配
   - `group`: 根据搜索模式进行模糊/精确匹配
   - `appName`: 精确匹配
   - `config_tags`: 标签包含匹配（支持多个标签，逗号分隔）
   - `types`: 类型包含匹配（支持多个类型，逗号分隔）
   - `config_detail`: 配置内容包含匹配

4. **分页处理**
   - 先过滤，再分页
   - 返回 `pageItems`、`totalCount`、`pageNumber`

### 4. 实现细节

**文件**: `mock/config.ts`

**关键改动**:

1. 将 `configList` 改为 `configListByTenant: Record<string, Config[]>`
2. 添加初始化函数，为每个命名空间生成配置数据
3. 完善查询接口的过滤逻辑
4. 确保创建/更新/删除操作也按 tenant 隔离

**数据生成示例**:

```typescript
function initConfigListForTenant(tenant: string): Config[] {
  return Mock.mock({
    'list|30-50': [
      {
        'id|+1': 1,
        'dataId': `@word(5, 10)`,
        'group': '@pick(["DEFAULT_GROUP", "TEST_GROUP", "PROD_GROUP"])',
        'appName': '@word(3, 8)',
        'type': '@pick(["text", "json", "yaml", "xml", "properties"])',
        'md5': '@string("lower", 32)',
        'content': '@cparagraph(1, 3)',
        'desc': '@csentence',
        'configTags': '@word(3, 6)',
      },
    ],
  }).list
}
```

**模糊搜索处理示例**:

```typescript
function matchPattern(value: string, pattern: string, isBlur: boolean): boolean {
  if (!pattern) return true
  
  if (isBlur) {
    // 处理通配符 *keyword* 或 keyword
    const cleanPattern = pattern.replace(/\*/g, '')
    return value.toLowerCase().includes(cleanPattern.toLowerCase())
  } else {
    // 精确匹配
    return value === pattern
  }
}
```

## 实施步骤

### Phase 1: Mock 数据优化（支持功能实现）

1. **重构数据结构**
   - 将 `configList` 改为 `configListByTenant: Record<string, Config[]>`
   - 添加 tenant 数据初始化函数
   - 为每个命名空间生成独立的配置数据（30-50 条）

2. **完善查询接口**
   - 实现 tenant 过滤
   - 实现模糊搜索逻辑（处理通配符 `*`）
   - 实现多条件组合过滤（dataId, group, appName, config_tags, types, config_detail）
   - 实现分页处理

3. **更新 CRUD 操作**
   - 确保创建操作按 tenant 隔离
   - 确保更新操作按 tenant 隔离
   - 确保删除操作按 tenant 隔离（单个/批量）

### Phase 2: 组件安装和准备

1. **安装 shadcn-vue 组件**
   ```bash
   # 安装必需组件
   pnpm shadcn-vue@latest add table
   pnpm shadcn-vue@latest add select
   pnpm shadcn-vue@latest add switch
   pnpm shadcn-vue@latest add pagination
   pnpm shadcn-vue@latest add form
   pnpm shadcn-vue@latest add dropdown-menu
   
   # 可选组件
   pnpm shadcn-vue@latest add badge
   pnpm shadcn-vue@latest add dialog
   pnpm shadcn-vue@latest add combobox
   ```

2. **组件使用规划**
   - **Table**: 配置列表展示，支持排序和行选择
   - **Select/Combobox**: Group 选择，支持自动完成
   - **Switch**: 模糊搜索模式切换
   - **Pagination**: 分页控制
   - **Form**: 查询表单布局
   - **Dropdown Menu**: 导出功能菜单
   - **Dialog**: 删除确认对话框
   - **Badge**: 标签显示

### Phase 3: 页面功能实现

1. **创建配置列表页面**
   - 文件位置：`src/pages/configuration/list.vue` 或类似路径
   - 使用组合式 API（Composition API）

2. **实现查询表单**
   - Data ID 输入框（支持模糊/精确搜索）
   - Group 下拉选择（支持自动完成）
   - 模糊搜索开关
   - 高级查询区域（可展开/收起）
   - 查询按钮

3. **实现配置列表表格**
   - 表格列：Data ID、Group、类型、应用、操作
   - 支持排序（按列排序）
   - 支持行选择（多选）
   - 加载状态显示
   - 空状态显示

4. **实现分页组件**
   - 页码切换
   - 每页数量选择
   - 总数显示

5. **实现操作功能**
   - 创建配置按钮（跳转）
   - 操作列：详情、编辑、删除、更多（版本、监听查询）
   - 批量操作：批量删除、批量克隆、导出选中

6. **实现命名空间切换**
   - 集成命名空间选择组件
   - 切换时重新加载数据

7. **集成 Service 层**
   - 使用 `configService.getList()` 获取配置列表
   - 处理加载状态和错误状态
   - 实现查询参数管理

## 技术实现要点

### 页面结构

```
配置列表页面
├── 页面标题和命名空间选择
├── 查询表单区域
│   ├── 基础查询（Data ID、Group、模糊搜索开关）
│   ├── 高级查询（可展开，应用名称、标签、类型、配置内容）
│   └── 操作按钮（查询、导入、高级查询切换）
├── 查询结果统计
├── 配置列表表格
│   ├── 表格列（Data ID、Group、类型、应用、操作）
│   ├── 行选择
│   └── 排序功能
├── 批量操作栏（删除、克隆、导出）
└── 分页组件
```

### 状态管理

- 使用组合式 API 的 `ref` 和 `reactive` 管理状态
- 查询参数：dataId, group, appName, config_tags, types, config_detail, search, pageNo, pageSize, tenant
- 表格状态：selectedRows, loading, sortField, sortOrder
- 表单状态：isAdvancedQuery, defaultFuzzySearch

### 接口调用

- 使用 `configService.getList()` 调用接口
- 接口返回数据格式：`{ pageItems: Config[], totalCount: number, pageNumber: number }`
- Mock 数据通过 `mock/config.ts` 提供

## 注意事项

- 保持与 React 实现的行为一致
- 确保向后兼容（如果没有 tenant 参数，使用默认 tenant）
- 模糊搜索需要正确处理通配符 `*`
- 标签和类型过滤支持逗号分隔的多个值
- 命名空间切换时需要重置查询条件和分页
- 表格排序在客户端实现（或调用后端接口）
- 使用组合式 API，保持代码简洁和可维护性

## 测试验证

### Mock 数据测试

1. **Tenant 隔离测试**
   - 不同 tenant 返回不同的配置列表
   - 切换 tenant 时数据正确更新

2. **查询功能测试**
   - 模糊搜索功能正常
   - 精确搜索功能正常
   - 多条件组合查询正常
   - 分页功能正常

3. **CRUD 操作测试**
   - 创建配置时正确关联 tenant
   - 更新配置时只能操作当前 tenant 的数据
   - 删除配置时只能删除当前 tenant 的数据

### 页面功能测试

1. **UI 交互测试**
   - 查询表单输入和提交
   - 模糊搜索开关切换
   - 高级查询展开/收起
   - 表格排序功能
   - 行选择功能
   - 分页切换

2. **功能测试**
   - 命名空间切换后数据刷新
   - 查询条件变化后数据刷新
   - 批量操作功能正常
   - 操作按钮跳转正常

3. **边界情况测试**
   - 空数据状态显示
   - 加载状态显示
   - 错误状态处理
   - 网络请求失败处理
